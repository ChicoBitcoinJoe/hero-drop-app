(this["webpackJsonphero-drop-app"]=this["webpackJsonphero-drop-app"]||[]).push([[0],{1054:function(e,t){},1109:function(e,t){},1118:function(e,t){},1120:function(e,t){},1243:function(e,t){},1295:function(e,t){},1321:function(e,t){},1323:function(e,t){},1350:function(e,t){},1521:function(e,t){},1523:function(e,t){},1652:function(e,t){},1714:function(e,t){},1731:function(e,t){},1733:function(e,t){},1791:function(e,t){},1985:function(e,t,n){},1990:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(55),i=n.n(o),c=(n(832),n(1)),u=n.n(c),s=n(39),l=n(32),d=n(812),f=n(2036),h=n(2037),p=n(2034),g=n(2035),m=n(2028),x=n(2038);var b=n(833),v=(n(1845),n(1987)),w=v.Magic,y=v.RPCError,k=v.RPCErrorCode,E=new w("pk_test_F879423DC899077C",{network:"ropsten"}),C=function(){var e=r.a.useState(!1),t=Object(s.a)(e,2),n=t[0],a=t[1],o=r.a.useState(!1),i=Object(s.a)(o,2),c=i[0],d=(i[1],r.a.useState("")),f=Object(s.a)(d,2),h=f[0],p=f[1],g=r.a.useState(),m=Object(s.a)(g,2),x=m[0],v=(m[1],r.a.useState()),w=Object(s.a)(v,2),C=w[0],O=(w[1],r.a.useState()),j=Object(s.a)(O,2),S=j[0],I=(j[1],function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a,r,o,i,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E.auth.loginWithMagicLink({email:t,showUI:!0});case 3:return e.next=5,E.user.isLoggedIn();case 5:if(!e.sent){e.next=23;break}return e.next=8,E.user.getMetadata();case 8:return n=e.sent,a=n.publicAddress,r=["hero-drop-app"],o=E.rpcProvider,e.next=14,b.create();case 14:return i=e.sent,e.next=17,i.auth(r,{address:a,provider:o});case 17:return e.next=19,i.syncDone;case 19:return c=i.spaces["hero-drop-app"],e.abrupt("return",{email:t,metadata:n,address:a,provider:o,box:i,storage:c});case 23:throw new Error("failed to log in");case 24:e.next=34;break;case 26:if(e.prev=26,e.t0=e.catch(0),console.error(e.t0),!(e.t0 instanceof y)){e.next=34;break}e.t1=e.t0.code,e.next=(e.t1===k.MagicLinkFailedVerification||e.t1===k.MagicLinkExpired||e.t1===k.MagicLinkRateLimited||(e.t1,k.UserAlreadyLoggedIn),33);break;case 33:return e.abrupt("break",34);case 34:case"end":return e.stop()}}),e,null,[[0,26]])})));return function(t){return e.apply(this,arguments)}}()),L=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.logout();case 2:return e.next=4,E.user.logout();case 4:a(!1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{email:h,isLoggingIn:c,isLoggedIn:n,address:x,box:C,data:S,login:I,logout:L,set:{email:p}}},O=n(209);function j(e){var t=r.a.useState(e),n=Object(s.a)(t,2),a=n[0],o=n[1];return[a,function(e){o((function(t){return Object(O.a)({},t,{},e)}))},o]}var S=n(123);function I(e){var t=r.a.useState(e),n=Object(s.a)(t,2),a=n[0],o=n[1];return{list:a,get:function(e){return[a[e],function(t){!function(e,t){var n=a;n[e]=Object(O.a)({},a[e],{},t),o(Object(S.a)(n))}(e,t)},function(t){!function(e,t){var n=a;n[e]=t,o(Object(S.a)(n))}(e,t)}]},push:function(e){o([].concat(Object(S.a)(a),[e]))},pop:function(e){if(e||(e=a.length-1),e<0||e>=a.length)return!1;var t=a.slice(0,e).concat(a.slice(e+1,a.length));return o(t),!0}}}function L(e){var t=r.a.useState(e.name),n=Object(s.a)(t,2),a=n[0],o=n[1],i=I(e.assets),c=j(e.background),d=Object(s.a)(c,3),f=d[0],h=d[1],p=d[2],g=j(e.grid),m=Object(s.a)(g,3),x=m[0],b=m[1],v=m[2];r.a.useEffect((function(){}),[]);var w=null;return[{name:a,assets:i,background:f,grid:x},{name:o,background:h,grid:b,src:function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h({src:t,width:0,height:0});case 2:h({height:f.ref.current.offsetHeight,width:f.ref.current.offsetWidth});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),width:function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h({width:t,height:0});case 2:h({height:f.ref.current.offsetHeight});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),height:function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h({height:t,width:0});case 2:h({width:f.ref.current.offsetWidth});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),hexSize:function(e){w&&clearInterval(w),b({hidden:!0}),w=setInterval((function(){clearInterval(w),b({hidden:!1})}),0),b({hexSize:e})}},{background:p,grid:v}]}var M=n(803),D=n(111),z=n(804),W=n.n(z),F=n(2032);n(2030),n(2033),n(810),n(486),n(2029),n(2031);Object(F.a)((function(e){return{form:{display:"flex",flexWrap:"wrap"}}}));var T=n(2039);function P(e){var t=e.asset;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{zIndex:"2",width:96*t.width+"px",height:96*t.height+24+"px"}},r.a.createElement(T.a,{style:{border:"4px solid "+(t.backgroundColor?t.backgroundColor:"rgba(255,255,255,1)"),width:t.width+"in",height:t.height+"in"},ref:t.ref,src:t.src}),t.text?r.a.createElement("div",{style:{whiteSpace:"nowrap",textAlign:"center",backgroundColor:t.backgroundColor?t.backgroundColor:"rgba(255,255,255,1)",color:t.textColor?t.textColor:"rgba(0,0,0,1)",margin:"4px 0px",padding:"0px 8px",height:"20px",width:t.width+"in",overflow:"hidden",textOverflow:"ellipsis",borderRadius:"16px",fontWeight:"bold"}},t.text):null))}function R(e){var t=e.asset;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{fontSize:t.fontSize+"px",fontWeight:t.fontWeight,color:t.textColor?t.textColor:"rgba(0,0,0,1)",width:t.width+"px",height:t.height+"px",border:"8px solid "+(t.backgroundColor?t.backgroundColor:"rgba(255,255,255,0)"),backgroundColor:t.backgroundColor}},t.text))}function _(e){var t=e.asset,n="rotate("+t.rotation+"deg)";return r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{alt:"object asset",src:t.src,onLoad:t.onLoad,ref:t.ref,style:{zIndex:"2",width:t.width?t.width+"px":"auto",height:t.height?t.height+"px":"auto",WebkitTransform:n,MozTransform:n,msTransform:n,OTransform:n,transform:n}}))}var B=function(e){var t=e.asset;return r.a.createElement(r.a.Fragment,null,"avatar"===t.type?r.a.createElement(P,{asset:t}):"text"===t.type?r.a.createElement(R,{asset:t}):"object"===t.type?r.a.createElement(_,{asset:t}):null)};function G(e){var t=e.assets,n=e.ContextMenu,a=e.onChange,o=e.locked,i=function(e){var t=r.a.useState(!1),n=Object(s.a)(t,2),a=n[0],o=n[1];return r.a.useEffect((function(){var t=function(t){var n=t.key;e===n&&o(!0)},n=function(t){var n=t.key;e===n&&o(!1)};return document.addEventListener("keydown",t),document.addEventListener("keyup",n),function(){document.removeEventListener("keydown",t),document.removeEventListener("keyup",n)}}),[]),a}("Control"),c=r.a.useState(),u=Object(s.a)(c,2),l=(u[0],u[1],r.a.useState(!1)),d=Object(s.a)(l,2),f=(d[0],d[1],function(e,t){return function(t,n){var r=n.x,o=n.y;a({target:"asset",function:"handleGrab",data:{id:e,x:r,y:o}})}}),h=null,p=null,g=null,m=function(e,t){return function(t,n){p=n.x,g=n.y,h||(h=setInterval((function(){a({target:"asset",function:"handleDrag",data:{id:e,x:p,y:g}})}),250))}},x=function(e,t){return function(t,n){var r=n.x,o=n.y;a({target:"asset",function:"handleDrop",data:{id:e,x:r,y:o}}),clearInterval(h)}};return r.a.createElement(r.a.Fragment,null,t.list.map((function(e,t){var a=(!e.locked||i)&&!o;return r.a.createElement("div",{key:t},r.a.createElement(D.MenuProvider,{id:"asset_menu"+t},r.a.createElement(W.a,{disabled:!a,position:{x:e.x,y:e.y},onStart:f(t),onDrag:m(t),onStop:x(t)},r.a.createElement("div",{className:"game-piece",style:{cursor:a?"grab":"default",userSelect:a?"default":"none",pointerEvents:a?"auto":"none"}},r.a.createElement("div",{style:{pointerEvents:"none"}},r.a.createElement(B,{asset:e}))))),n(e,t))})))}function N(e){e.ref;var t=e.src,n=e.width,a=e.height;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{position:"absolute",top:"0px",left:"0px",width:n+"px",height:a+"px"}},r.a.createElement("img",{alt:"gameboard",src:t,style:{display:"block",width:n>0?n+"px":"auto",height:a>0?a+"px":"auto"}})))}var H=n(260);function U(e){var t=e.container,n=e.settings,a=e.ContextMenu,o=e.onContextMenuOpen,i=e.hidden,c=e.onClick,u=n.hexSize,s=n.width,l=n.height,d=n.xOffset,f=n.yOffset;return r.a.createElement(r.a.Fragment,null,r.a.createElement(D.MenuProvider,{id:"menu_id_hex",onContextMenu:o},r.a.createElement("div",{style:{position:"absolute",top:"0px",left:"0px",width:t.width+"px",height:t.height+"px"}},r.a.createElement(H.HexGrid,{width:t.width,height:t.height,viewBox:d+" "+f+" 100 100"},i?null:r.a.createElement(H.Layout,{className:"hexagons",size:{x:u,y:u},spacing:1,flat:!1,origin:{x:0,y:0}},H.GridGenerator.rectangle(s,l).map((function(e,t){return e.draggable=!1,r.a.createElement(H.Hexagon,{key:t,q:e.q,r:e.r,s:e.s,className:e.blocked?"blocked":null,data:e,onClick:c})})))))),r.a.createElement(a,null))}function q(e){e.name;var t=e.assets,n=e.background,a=e.grid,o=(e.player,e.sync),i=e.allowRightClick,c=function(e){var t=e.event,n=(e.props,t.offsetX),a=t.offsetY;o({target:"grid",function:"ping",data:{x:n,y:a}})};return r.a.createElement(r.a.Fragment,null,r.a.createElement(M.a,{className:"game-board",ignoreElements:".game-piece",hideScrollbars:!1},r.a.createElement(N,n),r.a.createElement(U,{container:n,settings:a,onClick:function(e,t){var n=e.nativeEvent.offsetX,a=e.nativeEvent.offsetY;console.log("Clicked grid at:",n,a)},ContextMenu:function(e){return i?r.a.createElement(D.Menu,{id:"menu_id_hex"},r.a.createElement(D.Item,{onClick:c},"Ping Location")):null},onContextMenuOpen:function(){i&&console.log("Opened Grid Context Menu")},hidden:!1}),r.a.createElement(G,{assets:t,ContextMenu:function(e,t){return i?r.a.createElement(D.Menu,{id:"asset_menu"+t,style:{zIndex:"10"},onShown:function(){return function(e,t){console.log("Right clicked",{id:e,asset:t})}(t,e)}},r.a.createElement(D.Item,{onClick:function(){return function(e,t){console.log({id:e,asset:t})}(t,e)}},"Edit"),r.a.createElement(D.Submenu,{label:"Delete"},r.a.createElement(D.Item,{onClick:function(){return function(e,t){console.log({id:e,asset:t})}(t,e)}},"Confirm"))):null},onChange:function(e){o(e)},locked:!1})))}n(1985),n(1986);var A={name:"The Pool of Dreams",background:{src:"https://mk0a2minutetabl7hq7i.kinstacdn.com/wp-content/uploads/2019/05/Jungle-Temple-RPG-battle-map-color.jpg",width:1600,height:1120},grid:{hexSize:5.4,width:16,height:13,xOffset:21.4,yOffset:-2},assets:[{type:"avatar",src:"https://theoneworldblog.files.wordpress.com/2017/11/shepherd-druid.jpg?w=100",x:1315,y:519,textColor:"rgba(255,255,255,0.87)",backgroundColor:"rgba(255,51,51,1)",text:"Dalla",width:1,height:1},{type:"avatar",src:"https://external-preview.redd.it/rBBZcGNkiqI9Bvx-fB9XT9KEniDWNeuBNvs5EtZylYc.png?auto=webp&s=149ae6bfeeccd69989b1650309d623352fcaa4ca",x:215,y:246,textColor:"rgba(255,255,255,0.87)",backgroundColor:"rgba(55,251,51,1)",text:"Thader",width:1,height:1},{type:"object",src:"https://i.pinimg.com/originals/f2/8d/ed/f28ded56a3a38308a0d770d009f90416.png",x:476,y:616,width:150,height:150,rotation:140,locked:!0},{type:"object",src:"https://i.pinimg.com/originals/f2/8d/ed/f28ded56a3a38308a0d770d009f90416.png",x:536,y:436,width:150,height:150,rotation:0,locked:!0},{type:"text",text:"Hero",fontSize:80,fontWeight:"bold",x:795,y:320,textColor:"rgba(255,255,2550.87)",backgroundColor:"rgba(0,0,0,0)",width:360,height:240,locked:!0},{type:"text",text:"Drop",fontSize:80,fontWeight:"bold",x:845,y:412,textColor:"rgba(255,255,2550.87)",backgroundColor:"rgba(0,0,0,0)",width:360,height:240,locked:!0}]},J=Object(d.a)({palette:{type:"dark"}});function X(e,t){return Y.apply(this,arguments)}function Y(){return(Y=Object(l.a)(u.a.mark((function e(t,n){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.joinThread(n,{ghost:!0});case 2:return a=e.sent,e.abrupt("return",{storage:t,thread:a,sync:function(e){a.post(e)},onUpdate:function(e){return a.onUpdate(e)}});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e){var t=e.handleLogin,n=r.a.useState(r.a.createRef()),a=Object(s.a)(n,2),o=a[0],i=(a[1],r.a.useState(!1)),c=Object(s.a)(i,2),u=c[0],l=c[1],d=r.a.useState(""),f=Object(s.a)(d,2),h=f[0],b=f[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,{ref:o,style:{backgroundColor:"#44975f",color:"white",width:"97px"},size:"large",variant:"contained",onClick:function(){return l(!u)}},u?"close":"login"),r.a.createElement(g.a,{open:u,anchorEl:o.current,placement:"bottom-end"},r.a.createElement(m.a,{style:{marginTop:"24px",padding:"24px",maxWidth:"272px"},elevation:10},r.a.createElement("form",{noValidate:!0,autoComplete:"on",onSubmit:function(e){e.preventDefault(),t(h),l(!1)}},r.a.createElement(x.a,{inputProps:{style:{textAlign:"center"}},variant:"outlined",fullWidth:!0,name:"email",type:"email",placeholder:"Enter your email",value:h,onChange:function(e){b(e.target.value)}}),r.a.createElement(p.a,{style:{width:"100%",margin:"12px 0px 0px 0px"},type:"submit",disabled:!h},"continue")))))}var Z=function(){var e;e="Hero Drop",r.a.useEffect((function(){document.title=e}));var t=C(),n=L(A),a=Object(s.a)(n,3),o=a[0],i=(a[1],a[2],r.a.useState()),c=Object(s.a)(i,2),d=c[0],p=c[1],g=r.a.useState(!1),m=Object(s.a)(g,2),x=m[0],b=m[1],v=r.a.useState(!1),w=Object(s.a)(v,2),y=w[0],k=w[1],E=r.a.useState(),O=Object(s.a)(E,2),j=O[0],S=O[1],I=function(){var e=Object(l.a)(u.a.mark((function e(n){var a,r,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=function(e,t){if(e.author!==r.thread._3id.DID){var n=e.message;if("asset"===n.target){var a=n.data,i=a.id,c=a.x,u=a.y;"handleDrop"===n.function&&o.assets.get(i)[1]({x:c,y:u})}}},console.log("Logging in with",n),n){e.next=4;break}return e.abrupt("return");case 4:return k(!0),e.next=7,t.login(n);case 7:return a=e.sent,e.next=10,X(a.storage,"hero-drop-app");case 10:(r=e.sent).onUpdate(i),console.log(a),console.log(r),p(a),S(r),console.log("connected to server"),b(!0),k(!1);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a,r,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j&&j.sync(t),"asset"===t.target&&(n=t.data,a=n.id,r=n.x,i=n.y,"handleDrop"===t.function&&o.assets.get(a)[1]({x:r,y:i}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.useEffect((function(){}),[]),r.a.createElement(f.a,{theme:J},r.a.createElement(h.a,null),r.a.createElement("div",{style:{position:"relative",width:"100%",height:"100%"}},r.a.createElement("div",{style:{zIndex:"2",position:"absolute",top:"24px",right:"24px"}},x||y?null:r.a.createElement(V,{handleLogin:I})),r.a.createElement(q,Object.assign({},o,{player:d,sync:M,allowRightClick:!0}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Z,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},339:function(e,t){},827:function(e,t,n){e.exports=n(1990)},832:function(e,t,n){},842:function(e,t){},911:function(e,t){},912:function(e,t){}},[[827,1,2]]]);
//# sourceMappingURL=main.96b4f185.chunk.js.map